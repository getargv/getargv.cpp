<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libgetargv++: libgetargv++</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libgetargv++<span id="projectnumber">&#160;0.1</span>
   </div>
   <div id="projectbrief">C++ library for getting and printing other processes&#39; args</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">libgetargv++ </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> </p><h1><img src="logo.svg" alt="getargv" style="pointer-events: none;" width="200" class="inline"/></h1>
<p><a href="https://github.com/getargv/getargv.cpp/actions/workflows/actions.yml"><img src="https://github.com/getargv/getargv.cpp/actions/workflows/actions.yml/badge.svg" alt="C++/make CI" style="pointer-events: none;" class="inline"/></a></p>
<p><code>libgetargv++</code> is a library that allows you to get the arguments that were passed to another running process on macOS. It is intended to provide roughly the same functionality as reading from <code>/proc/&lt;pid&gt;/cmdline</code> on Linux. On macOS this is done by parsing the output of the <code>KERN_PROCARGS2</code> sysctl, which is <span title="always, in my observation">very often</span> implemented <a href="https://getargv.narzt.cam/hallofshame.html">incorrectly</a>, due to the overlooked possibility of leading empty arguments passed to the target process.</p>
<p>This is a library providing a more idiomatic C++ API wrapping the C API provided by libgetargv.</p>
<h2><a class="anchor" id="autotoc_md0"></a>
Permissions</h2>
<p><code>libgetargv++</code> can only see processes running as the same user by default, so be sure your process runs as the desired user (<code>setuid</code>, <a href="x-man-page://launchd.plist"><code>launchd.plist</code></a>, <a href="x-man-page://sudo"><code>sudo</code></a>) or can <a href="https://developer.apple.com/library/archive/documentation/Security/Conceptual/SecureCodingGuide/Articles/AccessControl.html">elevate privileges</a>; n.b. elevating privileges safely is <a href="https://developer.apple.com/forums/thread/708765">extremely complicated</a>, and will be a target of privilege escalation attacks on macOS so be extremely careful if you go this route, better to defer to the user to elevate privileges for you as needed.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Installation</h2>
<h3><a class="anchor" id="autotoc_md2"></a>
Step 1: Downloading</h3>
<p>You can download a <a href="https://github.com/getargv/getargv.cpp/archive/refs/tags/0.1.tar.gz">source bundle</a>, or an <a href="https://github.com/getargv/getargv.cpp/releases/download/0.1/libgetargv++-macos-13.dmg">installer package</a> from GitHub.</p>
<h3><a class="anchor" id="autotoc_md3"></a>
Step 2: Installing</h3>
<p>The simplest way to install this lib is via Homebrew, just run <code>brew tap getargv/tap</code> and then <code>brew install libgetargv++</code>. If you don't use Homebrew, then the next easiest way to install this lib is if you downloaded the installer package, which you can simply double click to be guided through the installation via a wizard. If you want to have absolute control over the installation you can unpack the pre-built library downloaded from GitHub and put it somewhere your compiler will pick it up, such as <code>/usr/local/lib</code> and put the headers somewhere like <code>/usr/local/include/libgetargv++</code>.</p>
<h3><a class="anchor" id="autotoc_md4"></a>
Step 3: Environment</h3>
<p>Be sure that your compiler can find this lib by checking the library and header search paths:</p>
<div class="fragment"><div class="line">echo | clang++ -c -v -x c++ - 2&gt;&amp;1 | sed -Ee &#39;/search starts here/,/End of search list/!d;/End of search list/q&#39;</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>&zwj;[!IMPORTANT] On Apple Silicon (ARM) Macs, Homebrew installs native packages in <code>/opt</code>, and puts Intel libraries in <code>/usr/local</code>, so your compiler will only automatically pick up Intel libraries, which is almost certainly not what you want. You need to explicitly exclude <code>/usr/local</code> from your search paths in this case and add <code>/opt/</code>. </p>
</blockquote>
<h3><a class="anchor" id="autotoc_md5"></a>
System Requirements</h3>
<p>macOS is required as this is a macOS specific <code>sysctl</code>, even BSD does not implement it. Your system must support <code>sysctl</code> and <code>KERN_PROCARGS2</code>, which probably means macOS <a href="https://github.com/apple-oss-distributions/xnu/blob/xnu-517/bsd/sys/sysctl.h#L332">10.3</a> or later, though I haven't tested versions older than 10.7. You'll also need a non-ancient Clang++ (C++11 is required, C++20 is the default standard on Clang++ versions &gt; 13, otherwise C++17) you can override the C++ std by setting <code>CXXFLAGS="--std=c++11 -O3 -Iinclude"</code>.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Building libgetargv++</h2>
<p>To make <code>libgetargv++</code>:</p>
<ul>
<li>Install <code>libgetargv</code> to your system (see below).</li>
<li>Clone <a href="https://github.com/getargv/getargv.cpp">this repo</a> and run <code>make</code>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md7"></a>
Building libgetargv</h2>
<p>To make <code>libgetargv</code> Clone <a href="https://github.com/getargv/getargv">the repo</a> and run <code>make dylib</code>.</p>
<p>I've built <code>libgetargv</code> on macOS 10.7-14, using only the CLT package, not the full Xcode install. If you need to override variables, do so inside the <code>make</code> command, eg: <code>make EXTRA_CPPFLAGS=-DMACRO EXTRA_CFLAGS=-std=c17 dylib</code>. If you are trying to build on a version of macOS earlier than 10.7, let me know how it goes.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Testing</h2>
<p>Run <code>make -C test</code>.</p>
<p>I've tested libgetargv++ on macOS 10.7-14, and run CI against all available GitHub hosted macOS runners, with plans to standup a CI cluster of VMs once I acquire appropriate hardware.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Usage</h2>
<h3><a class="anchor" id="autotoc_md10"></a>
Step 1: Choosing a struct</h3>
<p>Do you just want to print the arguments to <code>stdout</code> or look at the bytes of the arguments? Then you probably want the <code>Argv</code> struct, if you want to look at or parse the arguments, then you probably want the <code>ArgvArgc</code> struct. If you need to pass along the arguments to other functions that expect standard C++ types, then there are functions to give you those, however they are a bit less efficient as they involve additional copies.</p>
<h3><a class="anchor" id="autotoc_md11"></a>
Step 2: Choosing a constructor</h3>
<p>If you want to get a C++ type then <code>Argv::as_string()</code> or <code>ArgvArgc::as_string_array()</code> are your friends, if you want just the bytes, then <code>Argv()</code> or <code>Argv::as_bytes()</code> are for you, and if you want to look at the args individually then <code>ArgvArgc()</code> or <code>ArgvArgc::as_array()</code> are what you want.</p>
<h3><a class="anchor" id="autotoc_md12"></a>
Step 3: Iterating</h3>
<p>Once you have a struct, you can iterate over its contents in the usual way, for example:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> args = ArgvArgc(getpid());</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> arg : args) {</div>
<div class="line"><a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; arg &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">auto</span> bytes = Argv(getpid());</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keywordtype">byte</span> : bytes) {</div>
<div class="line"><a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; byte;</div>
<div class="line">}</div>
<div class="ttc" id="abasic_ostream_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md13"></a>
Safety</h2>
<p>This library attempts to provide guardrails where possible to avoid undefined behaviour, but C++ is not very well suited to the task, so care must still be taken. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
